{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-lg">
    <div>
        <h1 class="mt-0 mb-0">Dashboard</h1>
        <p class="text-muted mt-sm mb-0">Manage your potlucks</p>
    </div>
    <div class="btn-group">
        <a href="/admin/create" role="button">
            <i data-lucide="plus-circle"></i> New Potluck
        </a>
    </div>
</div>

{% if potlucks_data %}
    <!-- Desktop/Tablet Table View -->
    <table class="responsive-hide">
        <thead>
            <tr>
                <th>Potluck</th>
                <th>Stats</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for data in potlucks_data %}
            <tr>
                <td>
                    <strong>{{ data.potluck.name }}</strong>
                    {% if data.potluck.description %}
                    <br><small class="text-muted">{{ data.potluck.description }}</small>
                    {% endif %}
                </td>
                <td>
                    <div class="flex gap-sm">
                        <span class="badge">
                            <i data-lucide="folder"></i> {{ data.total_categories }}
                        </span>
                        <span class="badge">
                            <i data-lucide="package"></i> {{ data.total_items }}
                        </span>
                        <span class="badge {% if data.total_claims > 0 %}badge-success{% endif %}">
                            <i data-lucide="users"></i> {{ data.total_claims }}
                        </span>
                    </div>
                </td>
                <td>
                    <small class="text-muted">{{ data.potluck.created_at.strftime('%b %d, %Y') }}</small>
                </td>
                <td>
                    <div class="btn-group">
                        <a href="/admin/edit/{{ data.potluck.url_slug }}" role="button" class="contrast btn-sm">
                            <i data-lucide="edit"></i> Edit
                        </a>
                        <a href="/p/{{ data.potluck.url_slug }}" role="button" class="secondary btn-sm" target="_blank">
                            <i data-lucide="eye"></i> View
                        </a>
                    </div>
                    <br>
                    <small class="text-muted" style="font-size: 0.75rem;">
                        <code onclick="navigator.clipboard.writeText(window.location.origin + '/p/{{ data.potluck.url_slug }}'); this.textContent = 'Copied!'; setTimeout(() => this.textContent = '/p/{{ data.potluck.url_slug }}', 2000);" style="cursor: pointer; padding: 0.2rem 0.5rem; font-size: 0.7rem;">/p/{{ data.potluck.url_slug }}</code>
                    </small>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Mobile Card View -->
    <div class="mobile-card">
        {% for data in potlucks_data %}
        <div class="card">
            <div class="card-header">
                <div>
                    <h3 class="card-title">{{ data.potluck.name }}</h3>
                    {% if data.potluck.description %}
                    <p class="card-description">{{ data.potluck.description }}</p>
                    {% endif %}
                    <small class="text-muted">{{ data.potluck.created_at.strftime('%b %d, %Y') }}</small>
                </div>
            </div>

            <div class="card-body">
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value">{{ data.total_categories }}</span>
                        <span class="stat-label">
                            <i data-lucide="folder" style="width: 12px; height: 12px; vertical-align: middle;"></i>
                            Categories
                        </span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ data.total_items }}</span>
                        <span class="stat-label">
                            <i data-lucide="package" style="width: 12px; height: 12px; vertical-align: middle;"></i>
                            Items
                        </span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ data.total_claims }}</span>
                        <span class="stat-label">
                            <i data-lucide="users" style="width: 12px; height: 12px; vertical-align: middle;"></i>
                            Claims
                        </span>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <div class="btn-group" style="margin-bottom: 1rem;">
                    <a href="/admin/edit/{{ data.potluck.url_slug }}" role="button" class="contrast">
                        <i data-lucide="edit"></i> Edit
                    </a>
                    <a href="/p/{{ data.potluck.url_slug }}" role="button" class="secondary" target="_blank">
                        <i data-lucide="eye"></i> View
                    </a>
                </div>
                <div>
                    <small class="text-muted" style="display: block; margin-bottom: 0.5rem;">Shareable Link:</small>
                    <code onclick="navigator.clipboard.writeText(window.location.origin + '/p/{{ data.potluck.url_slug }}'); this.textContent = 'Copied!'; setTimeout(() => this.textContent = window.location.origin + '/p/{{ data.potluck.url_slug }}', 2000);">{{ request.url.scheme }}://{{ request.url.netloc }}/p/{{ data.potluck.url_slug }}</code>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="card text-center">
        <i data-lucide="inbox" style="width: 48px; height: 48px; margin: 0 auto 1rem; opacity: 0.5;"></i>
        <h3>No potlucks yet</h3>
        <p class="text-muted">Create your first potluck to get started!</p>
        <a href="/admin/create" role="button" style="margin: 1rem auto 0; display: inline-flex;">
            <i data-lucide="plus-circle"></i> Create Potluck
        </a>
    </div>
{% endif %}
{% endblock %}
